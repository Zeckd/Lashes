<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h2>

    <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
    <div class="mb-4">
        <button class="btn btn-success me-2" onclick="showForm()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
        <button class="btn btn-primary" onclick="loadClients()">üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</button>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="formContainer" class="card p-4 shadow-sm bg-white mb-4" style="display:none;">
        <form id="clientForm">
            <div class="mb-3">
                <label for="name" class="form-label">–ò–º—è</label>
                <input type="text" class="form-control" id="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            <div class="mb-3">
                <label for="phoneNumber" class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                <input type="text" class="form-control" id="phoneNumber" required placeholder="+996xxxxxxxxx">
            </div>
            <div class="mb-3">
                <label for="data" class="form-label">–î–∞–Ω–Ω—ã–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Ç.–¥.)</label>
                <textarea class="form-control" id="data" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            <div id="result" class="mt-3"></div>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
    <div id="tableContainer" class="card p-4 shadow-sm bg-white" style="display:none;">
        <h5>–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:</h5>
        <table class="table table-bordered table-striped mt-3">
            <thead>
            <tr>
                <th>ID</th>
                <th>–ò–º—è</th>
                <th>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</th>
                <th>–î–∞—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏—è</th>
                <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            </tr>
            </thead>
            <tbody id="clientTableBody">
            </tbody>
        </table>
    </div>
</div>

<script>
    const form = document.getElementById('clientForm');
    const result = document.getElementById('result');
    const formContainer = document.getElementById('formContainer');
    const tableContainer = document.getElementById('tableContainer');
    const tableBody = document.getElementById('clientTableBody');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    function showForm() {
        formContainer.style.display = 'block';
        tableContainer.style.display = 'none';
        result.innerHTML = '';
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    async function loadClients() {
        formContainer.style.display = 'none';
        tableContainer.style.display = 'block';
        tableBody.innerHTML = '';

        try {
            const response = await fetch('http://192.168.0.103:8080/client/getAll');
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤');

            const clients = await response.json();
            if (clients.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            } else {
                clients.forEach(client => {
                    const row = `
                        <tr>
                            <td>${client.id ?? '-'}</td>
                            <td>${client.name ?? '-'}</td>
                            <td>${client.phoneNumber ?? '-'}</td>
                            <td>${client.dateOfVisit ?? '-'}</td>
                            <td>${client.data ?? '-'}</td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            }
        } catch (err) {
            tableBody.innerHTML = `<tr><td colspan="5" class="text-danger">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('name').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const data = document.getElementById('data').value.trim();

        const body = { name, phoneNumber, data };

        try {
            const response = await fetch('http://192.168.0.103:8080/client/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });

            if (!response.ok) {
                const errText = await response.text();
                throw new Error(errText);
            }

            const resultData = await response.json();
            result.innerHTML = `<div class="alert alert-success">–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! ID: ${resultData.id}</div>`;
            form.reset();
        } catch (error) {
            result.innerHTML = `<div class="alert alert-danger">–û—à–∏–±–∫–∞: ${error.message}</div>`;
        }
    });
</script>

</body>
</html>
